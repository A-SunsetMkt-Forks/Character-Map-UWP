<Page
    x:Class="CharacterMap.Views.MainPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="using:CharacterMap.Controls"
    xmlns:core="using:CharacterMap.Core"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:helpers="using:CharacterMap.Helpers"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:views="using:CharacterMap.Views"
    xmlns:wct="using:Microsoft.Toolkit.Uwp.UI.Controls"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}"
    DataContext="{Binding Source={StaticResource Locator}, Path=Main}"
    mc:Ignorable="d">

    <Page.Resources>
        <!--  Ensure both of these are equal  -->
        <x:Double x:Key="SplitViewPaneWidth">256</x:Double>
        <GridLength x:Key="StatusBarPaneWidth">256</GridLength>

        <CollectionViewSource
            x:Key="GroupedFontList"
            x:Name="GroupedFontList"
            IsSourceGrouped="True"
            Source="{Binding GroupedFontList}" />

        <BackEase
            x:Key="BackOut4"
            Amplitude="0.4"
            EasingMode="EaseOut" />

    </Page.Resources>

    <Grid
        x:Name="LayoutRoot"
        AllowDrop="True"
        Background="Transparent"
        DragOver="Grid_DragOver"
        Drop="Grid_Drop"
        KeyDown="LayoutRoot_KeyDown"
        KeyUp="LayoutRoot_KeyUp">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition x:Name="TitleBarRow" Height="45" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="256" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <!--  Title Bar Grid  -->
        <controls:XamlTitleBar
            x:Name="TitleBar"
            Grid.Row="0"
            Grid.ColumnSpan="2"
            Canvas.ZIndex="1">
            <Grid ColumnSpacing="7">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                <ToggleButton
                    x:Uid="ToggleFullScreenModeButton"
                    Command="{Binding CommandToggleFullScreen}"
                    Foreground="{x:Bind core:Converters.GetForegroundBrush(ThemeLock), Mode=OneWay}"
                    Style="{StaticResource IconToggleButtonStyle}"
                    ToolTipService.Placement="Right">
                    <FontIcon FontSize="14" Glyph="&#xE740;" />
                </ToggleButton>
                <TextBlock
                    Grid.Column="1"
                    VerticalAlignment="Center"
                    FontSize="12"
                    Foreground="{x:Bind core:Converters.GetForegroundBrush(ThemeLock), Mode=OneWay}"
                    IsHitTestVisible="False">
                    <Run Text="{Binding TitlePrefix}" />
                    <Run x:Uid="TxtTitle" />
                </TextBlock>
            </Grid>
        </controls:XamlTitleBar>

        <!--  Commands Grid  -->
        <Grid
            x:Name="CommandsGrid"
            Grid.Row="1"
            Grid.Column="0"
            Grid.ColumnSpan="2"
            Background="{ThemeResource SystemControlBackgroundAccentBrush}"
            Loading="CommandsGrid_Loading"
            RequestedTheme="{x:Bind core:Converters.ChooseThemeForAccent(ThemeLock), Mode=OneWay}">

            <FrameworkElement.RenderTransform>
                <CompositeTransform />
            </FrameworkElement.RenderTransform>

            <Grid.ColumnDefinitions>
                <ColumnDefinition x:Name="SplitViewPaneColumn" Width="{StaticResource StatusBarPaneWidth}" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="0" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <AppBarButton
                x:Name="OpenFontPaneButton"
                Width="45"
                Height="45"
                Click="OpenFontPaneButton_Click"
                Foreground="{x:Bind core:Converters.GetForegroundBrush(ThemeLock), Mode=OneWay}"
                Visibility="Collapsed">
                <SymbolIcon Symbol="GlobalNavigationButton" />
            </AppBarButton>

            <TextBlock
                x:Name="FontTitleBlock"
                Grid.Column="1"
                Margin="24,0,5,0"
                VerticalAlignment="Center"
                FontSize="22"
                FontWeight="SemiLight"
                Foreground="{x:Bind core:Converters.GetForegroundBrush(ThemeLock), Mode=OneWay}"
                Loaded="{x:Bind helpers:Composition.SetStandardReposition}"
                Text="{Binding SelectedFont.Name, Mode=OneWay}"
                TextTrimming="CharacterEllipsis">
                <FrameworkElement.RenderTransform>
                    <CompositeTransform />
                </FrameworkElement.RenderTransform>
            </TextBlock>

            <AutoSuggestBox
                x:Name="SearchBox"
                x:Uid="SearchBox"
                Grid.Column="2"
                Width="290"
                VerticalAlignment="Center"
                GotFocus="{x:Bind FontMap.SearchBox_GotFocus}"
                ItemTemplate="{StaticResource SearchResultTemplate}"
                ItemsSource="{x:Bind FontMap.ViewModel.SearchResults, Mode=OneWay}"
                PlaceholderText="#SearchBox"
                PreviewKeyDown="{x:Bind FontMap.SearchBox_PreviewKeyDown}"
                QuerySubmitted="{x:Bind FontMap.SearchBox_QuerySubmitted}"
                SuggestionChosen="{x:Bind FontMap.SearchBox_SuggestionChosen}"
                Tag="{Binding ElementName=FontMap, Path=ViewModel.FontFamily}"
                Text="{Binding ElementName=FontMap, Path=ViewModel.SearchQuery, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                TextChanged="{x:Bind FontMap.SearchBox_TextChanged}"
                TextMemberPath="Description"
                UpdateTextOnSelect="False">
                <FrameworkElement.RenderTransform>
                    <CompositeTransform />
                </FrameworkElement.RenderTransform>
                <AutoSuggestBox.QueryIcon>
                    <SymbolIcon Symbol="Find" />
                </AutoSuggestBox.QueryIcon>
            </AutoSuggestBox>

            <AppBarButton
                x:Name="BtnSettings"
                Grid.Column="4"
                Width="45"
                Height="45"
                Click="BtnSettings_OnClick"
                Foreground="{x:Bind core:Converters.GetForegroundBrush(ThemeLock), Mode=OneWay}">
                <FontIcon
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    FontSize="16"
                    Glyph="&#xE115;" />
                <FrameworkElement.RenderTransform>
                    <CompositeTransform />
                </FrameworkElement.RenderTransform>
            </AppBarButton>
        </Grid>


        <!--  Main Content  -->
        <SplitView
            x:Name="SplitView"
            Grid.Row="1"
            Grid.RowSpan="3"
            Grid.ColumnSpan="3"
            DisplayMode="Inline"
            IsPaneOpen="True"
            OpenPaneLength="{StaticResource SplitViewPaneWidth}"
            PaneBackground="Transparent">
            <SplitView.Pane>
                <Grid x:Name="PaneRoot" Loading="PaneRoot_Loading">

                    <Grid.RowDefinitions>
                        <RowDefinition Height="{x:Bind TitleBarRow.Height}" />
                        <RowDefinition Height="*" />
                        <RowDefinition x:Name="StatusBarRow" Height="26" />
                    </Grid.RowDefinitions>

                    <!--  Pane Header Commands  -->
                    <Grid
                        x:Name="PaneHeaderGrid"
                        Loading="PaneHeaderGrid_Loading"
                        RequestedTheme="{x:Bind core:Converters.ChooseThemeForAccent(ThemeLock), Mode=OneWay}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <Button
                            x:Name="FontListFilter"
                            x:Uid="FontListFilter"
                            Height="45"
                            Margin="0,0,0,0"
                            Padding="12,6"
                            HorizontalAlignment="Stretch"
                            VerticalAlignment="Stretch"
                            HorizontalContentAlignment="Left"
                            Background="Transparent"
                            Content="{x:Bind ViewModel.FilterTitle, Mode=OneWay}"
                            FontSize="16"
                            Foreground="{x:Bind core:Converters.GetForegroundBrush(ThemeLock), Mode=OneWay}"
                            Style="{StaticResource TransparentHintButton}"
                            ToolTipService.Placement="Bottom">
                            <FrameworkElement.RenderTransform>
                                <CompositeTransform />
                            </FrameworkElement.RenderTransform>
                            <Button.Flyout>
                                <MenuFlyout Opening="MenuFlyout_Opening" Placement="BottomEdgeAlignedRight">
                                    <MenuFlyout.MenuFlyoutPresenterStyle>
                                        <Style TargetType="MenuFlyoutPresenter">
                                            <Setter Property="RequestedTheme" Value="Default" />
                                            <Setter Property="FontSize" Value="16" />
                                        </Style>
                                    </MenuFlyout.MenuFlyoutPresenterStyle>
                                    <MenuFlyoutItem
                                        x:Uid="OptionAllFonts"
                                        Click="Filter_Click"
                                        FontSize="16"
                                        Tag="0" />
                                    <MenuFlyoutItem
                                        x:Uid="OptionSerifFonts"
                                        Click="Filter_Click"
                                        FontSize="16"
                                        Tag="4" />
                                    <MenuFlyoutItem
                                        x:Uid="OptionSansSerifFonts"
                                        Click="Filter_Click"
                                        FontSize="16"
                                        Tag="5" />
                                    <MenuFlyoutItem
                                        x:Uid="OptionSymbolFonts"
                                        Click="Filter_Click"
                                        FontSize="16"
                                        Tag="1" />
                                    <MenuFlyoutSubItem x:Uid="OptionMoreFilters" FontSize="16">
                                        <MenuFlyoutItem
                                            x:Uid="OptionColorFonts"
                                            Click="Filter_Click"
                                            FontSize="16"
                                            Tag="10" />
                                        <MenuFlyoutItem
                                            x:Uid="OptionDecorativeFonts"
                                            Click="Filter_Click"
                                            FontSize="16"
                                            Tag="8" />
                                        <MenuFlyoutItem
                                            x:Uid="OptionScriptFonts"
                                            Click="Filter_Click"
                                            FontSize="16"
                                            Tag="9" />
                                        <MenuFlyoutItem
                                            x:Uid="OptionMonospacedFonts"
                                            Click="Filter_Click"
                                            FontSize="16"
                                            Tag="3" />
                                        <!--<MenuFlyoutSeparator />
                                <MenuFlyoutItem
                                    Text="Normal Fonts"
                                    Click="Filter_Click"
                                    Tag="11" />
                                <MenuFlyoutItem
                                    Text="Italic Fonts"
                                    Click="Filter_Click"
                                    Tag="12" />
                                <MenuFlyoutItem
                                    Text="Oblique Fonts"
                                    Click="Filter_Click"
                                    Tag="13" />-->
                                        <MenuFlyoutSeparator x:Name="FontSourceSeperator" />
                                        <MenuFlyoutItem
                                            x:Name="CloudFontsOption"
                                            x:Uid="OptionCloudFonts"
                                            Click="Filter_Click"
                                            FontSize="16"
                                            Tag="7" />
                                        <MenuFlyoutItem
                                            x:Name="AppxOption"
                                            x:Uid="OptionAppxFonts"
                                            Click="Filter_Click"
                                            FontSize="16"
                                            Tag="6" />
                                    </MenuFlyoutSubItem>
                                    <MenuFlyoutSeparator />
                                    <MenuFlyoutItem
                                        x:Uid="OptionImportedFonts"
                                        Click="Filter_Click"
                                        FontSize="16"
                                        Tag="2" />
                                </MenuFlyout>
                            </Button.Flyout>
                        </Button>

                        <AppBarButton
                            x:Name="ImportFontsButton"
                            x:Uid="ImportFontsButton"
                            Grid.Column="1"
                            Width="45"
                            Height="45"
                            VerticalAlignment="Bottom"
                            Click="{x:Bind PickFonts}"
                            Foreground="{x:Bind core:Converters.GetForegroundBrush(ThemeLock), Mode=OneWay}"
                            Visibility="Collapsed">
                            <FontIcon
                                FontSize="16"
                                Glyph="&#xE109;"
                                Opacity="0.8" />
                        </AppBarButton>

                        <AppBarButton
                            x:Name="OpenFontButton"
                            x:Uid="OpenFontButton"
                            Grid.Column="2"
                            Width="45"
                            Height="45"
                            VerticalAlignment="Bottom"
                            Click="{x:Bind OpenFont}"
                            Foreground="{x:Bind core:Converters.GetForegroundBrush(ThemeLock), Mode=OneWay}">
                            <FrameworkElement.RenderTransform>
                                <CompositeTransform />
                            </FrameworkElement.RenderTransform>
                            <Path
                                Height="16"
                                Data="M896,320L1012,320L788,768L0,768L0,128L338.5,128L466.5,0L896,0ZM64,192L64,632.5L220.5,320L832,320L832,64L493.5,64L365.5,192ZM748,704L908,384L260,384L99.5,704Z"
                                Fill="{x:Bind core:Converters.GetForegroundBrush(ThemeLock), Mode=OneWay}"
                                Opacity="0.8"
                                Stretch="Uniform" />
                        </AppBarButton>
                    </Grid>

                    <!--  Font List Grid  -->
                    <Grid
                        x:Name="FontListGrid"
                        Grid.Row="1"
                        Background="{ThemeResource SystemControlBackgroundChromeMediumBrush}"
                        Loading="FontListGrid_Loading">

                        <FrameworkElement.RenderTransform>
                            <CompositeTransform />
                        </FrameworkElement.RenderTransform>

                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <Grid x:Name="CollectionControlRow" Visibility="{x:Bind core:Converters.IsNotNullToVis(ViewModel.SelectedCollection), Mode=OneWay, FallbackValue=Collapsed}">
                            <Border x:Name="CollectionControlBackground">
                                <Border.Background>
                                    <SolidColorBrush Opacity="0.4" Color="{ThemeResource SystemAccentColor}" />
                                </Border.Background>
                            </Border>
                            <StackPanel
                                x:Name="CollectionControlItems"
                                Padding="0,0"
                                HorizontalAlignment="Center"
                                Orientation="Horizontal"
                                Spacing="12">
                                <AppBarButton
                                    x:Uid="RenameCollectionButton"
                                    Height="48"
                                    Click="RenameFontCollection_Click"
                                    Icon="Rename"
                                    ToolTipService.Placement="Bottom" />
                                <AppBarButton
                                    x:Uid="DeleteCollectionButton"
                                    Height="48"
                                    Click="DeleteCollection_Click"
                                    Icon="Delete"
                                    ToolTipService.Placement="Bottom" />
                            </StackPanel>
                        </Grid>

                        <TextBlock
                            x:Name="ImportFontHelpBlock"
                            x:Uid="ImportFontHelpBlock"
                            Grid.Row="1"
                            Margin="12"
                            FontSize="13"
                            Opacity="0.7"
                            Style="{StaticResource CaptionTextBlockStyle}"
                            Visibility="Collapsed" />

                        <SemanticZoom x:Name="FontsSemanticZoom" Grid.Row="1">
                            <SemanticZoom.ZoomedInView>
                                <ListView
                                    x:Name="LstFontFamily"
                                    IsItemClickEnabled="False"
                                    IsSwipeEnabled="False"
                                    ItemTemplate="{StaticResource FontListItemTemplate}"
                                    ItemsSource="{Binding Source={StaticResource GroupedFontList}}"
                                    SelectedValuePath="Name"
                                    SelectionChanged="LstFontFamily_SelectionChanged"
                                    SelectionMode="Single"
                                    ShowsScrollingPlaceholders="False">

                                    <ListView.ItemContainerTransitions>
                                        <TransitionCollection />
                                    </ListView.ItemContainerTransitions>

                                    <ListView.Resources>
                                        <Style BasedOn="{StaticResource ListViewItemRevealStyle}" TargetType="ListViewItem">
                                            <Setter Property="HorizontalAlignment" Value="Stretch" />
                                            <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                                        </Style>
                                    </ListView.Resources>

                                    <ListView.GroupStyle>
                                        <GroupStyle HeaderContainerStyle="{ThemeResource FontListHeaderItem}" HidesIfEmpty="True">
                                            <GroupStyle.HeaderTemplate>
                                                <DataTemplate>
                                                    <GridViewItem
                                                        x:Name="Root"
                                                        Margin="0"
                                                        Padding="0"
                                                        HorizontalAlignment="Stretch"
                                                        HorizontalContentAlignment="Stretch"
                                                        IsHitTestVisible="True">
                                                        <Border
                                                            Margin="15,0"
                                                            BorderBrush="#CCC"
                                                            BorderThickness="0,0,0,1">
                                                            <TextBlock
                                                                Padding="0,8,0,10"
                                                                HorizontalAlignment="Stretch"
                                                                VerticalAlignment="Stretch"
                                                                FontSize="30"
                                                                FontWeight="SemiLight"
                                                                Foreground="{ThemeResource SystemControlForegroundAccentBrush}"
                                                                Text="{Binding Key}" />
                                                        </Border>
                                                    </GridViewItem>
                                                </DataTemplate>
                                            </GroupStyle.HeaderTemplate>
                                        </GroupStyle>
                                    </ListView.GroupStyle>
                                </ListView>
                            </SemanticZoom.ZoomedInView>
                            <SemanticZoom.ZoomedOutView>
                                <GridView
                                    x:Name="ZoomGridView"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    ItemsSource="{Binding CollectionGroups, Source={StaticResource GroupedFontList}}">
                                    <GridView.ItemTemplate>
                                        <DataTemplate>
                                            <Border Width="64" Height="64">
                                                <TextBlock
                                                    HorizontalAlignment="Center"
                                                    VerticalAlignment="Center"
                                                    FontSize="32"
                                                    FontWeight="SemiLight"
                                                    Foreground="{Binding Group.Count, Converter={StaticResource ZoomBackgroundConverter}}"
                                                    Text="{Binding Group.Key}" />
                                            </Border>
                                        </DataTemplate>
                                    </GridView.ItemTemplate>
                                </GridView>
                            </SemanticZoom.ZoomedOutView>
                        </SemanticZoom>
                    </Grid>

                    <!--  Pane Status Bar  -->
                    <Grid
                        x:Name="PaneStatusBar"
                        Grid.Row="2"
                        Background="{ThemeResource SystemControlBackgroundAccentBrush}"
                        RequestedTheme="{x:Bind core:Converters.ChooseThemeForAccent(ThemeLock), Mode=OneWay}">
                        <Grid.Resources>
                            <Style TargetType="TextBlock">
                                <Setter Property="FontSize" Value="12" />
                                <Setter Property="VerticalAlignment" Value="Center" />
                                <Setter Property="Margin" Value="12 0" />
                                <Setter Property="TextLineBounds" Value="Tight" />
                            </Style>
                        </Grid.Resources>

                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <AppBarButton
                            x:Name="HidePaneButton"
                            x:Uid="BtnHidePane"
                            Width="32"
                            Margin="0 0 -6 0"
                            VerticalAlignment="Stretch"
                            Click="TogglePane_Click"
                            Foreground="{x:Bind core:Converters.GetForegroundBrush(ThemeLock), Mode=OneWay}">
                            <FontIcon
                                FontFamily="{ThemeResource SymbolThemeFontFamily}"
                                FontSize="16"
                                Glyph="&#xE127;" />
                        </AppBarButton>

                        <AppBarButton
                            x:Name="ShowPaneButton2"
                            x:Uid="BtnShowPane"
                            Width="32"
                            Margin="0 0 -6 0"
                            VerticalAlignment="Stretch"
                            Click="TogglePane_Click"
                            Foreground="{x:Bind core:Converters.GetForegroundBrush(ThemeLock), Mode=OneWay}"
                            Visibility="Collapsed">
                            <FontIcon
                                FontFamily="{ThemeResource SymbolThemeFontFamily}"
                                FontSize="16"
                                Glyph="&#xE126;" />
                        </AppBarButton>

                        <TextBlock
                            x:Name="FontFamilyCountLabel"
                            Grid.Column="1"
                            Foreground="{x:Bind core:Converters.GetForegroundBrush(ThemeLock), Mode=OneWay}"
                            Text="{x:Bind UpdateFontCountLabel(ViewModel.FontList), Mode=OneWay}" />

                    </Grid>

                </Grid>
            </SplitView.Pane>

            <!--  FontMap Grid  -->
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="{x:Bind TitleBarRow.Height}" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="{x:Bind StatusBarRow.Height}" />
                </Grid.RowDefinitions>

                <views:FontMapView
                    x:Name="FontMap"
                    Grid.Row="1"
                    Font="{x:Bind ViewModel.SelectedFont, Mode=OneWay}">
                    <FrameworkElement.RenderTransform>
                        <CompositeTransform />
                    </FrameworkElement.RenderTransform>
                </views:FontMapView>

                <!--  Status Bar  -->
                <Grid
                    x:Name="StatusBar"
                    Grid.Row="2"
                    Grid.Column="0"
                    Background="{ThemeResource SystemControlBackgroundAccentBrush}"
                    RequestedTheme="{x:Bind core:Converters.ChooseThemeForAccent(ThemeLock), Mode=OneWay}">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <Grid.Resources>
                        <Style TargetType="TextBlock">
                            <Setter Property="FontSize" Value="12" />
                            <Setter Property="VerticalAlignment" Value="Center" />
                            <Setter Property="Margin" Value="12 0" />
                            <Setter Property="TextLineBounds" Value="Tight" />
                        </Style>
                    </Grid.Resources>

                    <AppBarButton
                        x:Name="ShowPaneButton"
                        x:Uid="BtnShowPane"
                        Width="32"
                        Margin="0 0 -6 0"
                        VerticalAlignment="Stretch"
                        Click="TogglePane_Click"
                        Foreground="{x:Bind core:Converters.GetForegroundBrush(ThemeLock), Mode=OneWay}"
                        Visibility="Collapsed">
                        <FontIcon
                            FontFamily="{ThemeResource SymbolThemeFontFamily}"
                            FontSize="16"
                            Glyph="&#xE126;" />
                    </AppBarButton>

                    <TextBlock
                        Grid.Column="1"
                        Foreground="{x:Bind core:Converters.GetForegroundBrush(ThemeLock), Mode=OneWay}"
                        Text="{x:Bind UpdateCharacterCountLabel(FontMap.ViewModel.SelectedVariant), Mode=OneWay}" />

                    <TextBlock
                        Grid.Column="2"
                        Foreground="{x:Bind core:Converters.GetForegroundBrush(ThemeLock), Mode=OneWay}"
                        Loaded="{x:Bind helpers:Composition.SetStandardReposition}"
                        Text="{x:Bind FontMap.ViewModel.GetCharDescription(FontMap.ViewModel.SelectedChar), Mode=OneWay}" />
                </Grid>
            </Grid>
        </SplitView>

        <!--  Status Bar Background (for content resize)  -->
        <Rectangle
            Grid.Row="3"
            Grid.ColumnSpan="10"
            Height="26"
            VerticalAlignment="Bottom"
            Canvas.ZIndex="-1"
            Fill="{x:Bind StatusBar.Background, Mode=OneWay}" />

        <!--  Loading Root  -->
        <ProgressRing
            x:Name="LoadingRing"
            Grid.Row="2"
            Grid.ColumnSpan="2"
            Width="50"
            Height="50" />

        <views:SettingsView
            x:Name="SettingsView"
            x:Load="False"
            Grid.Row="1"
            Grid.RowSpan="3"
            Grid.ColumnSpan="10"
            Visibility="Collapsed" />

        <!--  Startup Exception Root  -->
        <Grid
            x:Name="StartupFailedRoot"
            x:Load="{x:Bind ViewModel.IsLoadingFontsFailed, Mode=OneWay}"
            Grid.Row="2"
            Grid.ColumnSpan="10">
            <StackPanel
                Margin="40"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Spacing="8">
                <TextBlock
                    Style="{StaticResource TitleTextBlockStyle}"
                    Text="Uh Oh"
                    TextAlignment="Center" />
                <TextBlock
                    Style="{StaticResource BodyTextBlockStyle}"
                    TextAlignment="Center"
                    TextWrapping="Wrap">
                    <Run Text="Something went wrong and we couldn't start the app right now." />
                    <LineBreak />
                    <LineBreak /><Run Text="Please consider posting details about this error to GitHub so we can help you fix it." />
                </TextBlock>
                <Button
                    MinWidth="200"
                    Margin="0 8 0 0"
                    HorizontalAlignment="Center"
                    Click="{x:Bind ViewModel.ShowStartUpException}"
                    Content="Show Details" />
            </StackPanel>
        </Grid>

        <!--  Notification Presenter  -->
        <Grid
            x:Name="NotificationRoot"
            x:Load="False"
            Grid.RowSpan="3"
            Grid.ColumnSpan="10">
            <wct:InAppNotification x:Name="DefaultNotification" />
        </Grid>

        <VisualStateManager.VisualStateGroups>
            <VisualStateGroup x:Name="ViewStates">
                <VisualState x:Name="CompactViewState">
                    <VisualState.Setters>
                        <Setter Target="SplitView.IsPaneOpen" Value="False" />
                        <Setter Target="SplitView.DisplayMode" Value="Overlay" />
                        <Setter Target="SplitViewPaneColumn.Width" Value="Auto" />
                        <Setter Target="OpenFontPaneButton.Visibility" Value="Visible" />
                        <Setter Target="FontTitleBlock.Margin" Value="8 0 5 0" />
                        <Setter Target="PaneHeaderGrid.Background" Value="{ThemeResource SystemAccentColorDark1}" />
                        <Setter Target="PaneStatusBar.Background" Value="{ThemeResource SystemAccentColorDark1}" />
                        <Setter Target="FontListGrid.Background" Value="{ThemeResource SystemControlChromeMediumLowAcrylicElementMediumBrush}" />

                        <Setter Target="ShowPaneButton.Visibility" Value="Collapsed" />
                        <Setter Target="ShowPaneButton2.Visibility" Value="Collapsed" />
                        <Setter Target="HidePaneButton.Visibility" Value="Collapsed" />
                    </VisualState.Setters>
                </VisualState>
                <VisualState x:Name="CollapsedViewState">
                    <VisualState.Setters>
                        <Setter Target="SplitView.IsPaneOpen" Value="False" />
                        <Setter Target="SplitView.DisplayMode" Value="Overlay" />
                        <Setter Target="SplitViewPaneColumn.Width" Value="Auto" />
                        <Setter Target="OpenFontPaneButton.Visibility" Value="Visible" />
                        <Setter Target="FontTitleBlock.Margin" Value="8 0 5 0" />
                        <Setter Target="PaneHeaderGrid.Background" Value="{ThemeResource SystemAccentColorDark1}" />
                        <Setter Target="PaneStatusBar.Background" Value="{ThemeResource SystemAccentColorDark1}" />
                        <Setter Target="FontListGrid.Background" Value="{ThemeResource SystemControlChromeMediumLowAcrylicElementMediumBrush}" />

                        <Setter Target="ShowPaneButton.Visibility" Value="Visible" />
                        <Setter Target="ShowPaneButton2.Visibility" Value="Visible" />
                        <Setter Target="HidePaneButton.Visibility" Value="Collapsed" />
                    </VisualState.Setters>
                </VisualState>
                <VisualState x:Name="DefaultViewState">
                    <VisualState.Setters>
                        <Setter Target="SplitView.IsPaneOpen" Value="True" />
                        <Setter Target="SplitView.DisplayMode" Value="Inline" />
                    </VisualState.Setters>
                </VisualState>
            </VisualStateGroup>
            <VisualStateGroup x:Name="LoadingStates">
                <VisualStateGroup.Transitions>
                    <VisualTransition
                        GeneratedDuration="0:0:0"
                        From="FontsLoadingState"
                        To="FontsLoadedState">
                        <Storyboard>
                            <DoubleAnimationUsingKeyFrames Storyboard.TargetName="CommandsGrid" Storyboard.TargetProperty="(UIElement.RenderTransform).(CompositeTransform.TranslateY)">
                                <LinearDoubleKeyFrame KeyTime="0:0:0" Value="-45" />
                                <SplineDoubleKeyFrame KeySpline="0.1 0.9 0.2 1.0" KeyTime="0:0:0.5" Value="0" />
                            </DoubleAnimationUsingKeyFrames>
                            <DoubleAnimationUsingKeyFrames Storyboard.TargetName="FontTitleBlock" Storyboard.TargetProperty="(UIElement.RenderTransform).(CompositeTransform.TranslateY)">
                                <LinearDoubleKeyFrame KeyTime="0:0:0" Value="-100" />
                                <EasingDoubleKeyFrame EasingFunction="{StaticResource BackOut4}" KeyTime="0:0:0.7" Value="0" />
                            </DoubleAnimationUsingKeyFrames>
                            <DoubleAnimationUsingKeyFrames Storyboard.TargetName="SearchBox" Storyboard.TargetProperty="(UIElement.RenderTransform).(CompositeTransform.TranslateY)">
                                <LinearDoubleKeyFrame KeyTime="0:0:0" Value="-100" />
                                <LinearDoubleKeyFrame KeyTime="0:0:0.1" Value="-100" />
                                <EasingDoubleKeyFrame EasingFunction="{StaticResource BackOut4}" KeyTime="0:0:0.8" Value="0" />
                            </DoubleAnimationUsingKeyFrames>
                            <DoubleAnimationUsingKeyFrames Storyboard.TargetName="BtnSettings" Storyboard.TargetProperty="(UIElement.RenderTransform).(CompositeTransform.TranslateY)">
                                <LinearDoubleKeyFrame KeyTime="0:0:0" Value="-100" />
                                <LinearDoubleKeyFrame KeyTime="0:0:0.2" Value="-100" />
                                <EasingDoubleKeyFrame EasingFunction="{StaticResource BackOut4}" KeyTime="0:0:0.9" Value="0" />
                            </DoubleAnimationUsingKeyFrames>
                            <DoubleAnimationUsingKeyFrames Storyboard.TargetName="OpenFontButton" Storyboard.TargetProperty="(UIElement.RenderTransform).(CompositeTransform.TranslateY)">
                                <LinearDoubleKeyFrame KeyTime="0:0:0" Value="-100" />
                                <LinearDoubleKeyFrame KeyTime="0:0:0.1" Value="-100" />
                                <EasingDoubleKeyFrame EasingFunction="{StaticResource BackOut4}" KeyTime="0:0:0.8" Value="0" />
                            </DoubleAnimationUsingKeyFrames>
                            <DoubleAnimationUsingKeyFrames Storyboard.TargetName="FontListFilter" Storyboard.TargetProperty="(UIElement.RenderTransform).(CompositeTransform.TranslateY)">
                                <LinearDoubleKeyFrame KeyTime="0:0:0" Value="-60" />
                                <LinearDoubleKeyFrame KeyTime="0:0:0.2" Value="-60" />
                                <EasingDoubleKeyFrame EasingFunction="{StaticResource BackOut4}" KeyTime="0:0:0.9" Value="0" />
                            </DoubleAnimationUsingKeyFrames>
                            <DoubleAnimationUsingKeyFrames Storyboard.TargetName="FontMap" Storyboard.TargetProperty="Opacity">
                                <LinearDoubleKeyFrame KeyTime="0:0:0" Value="0" />
                                <LinearDoubleKeyFrame KeyTime="0:0:0.4" Value="0" />
                                <LinearDoubleKeyFrame KeyTime="0:0:0.73" Value="1" />
                            </DoubleAnimationUsingKeyFrames>
                            <DoubleAnimationUsingKeyFrames Storyboard.TargetName="FontMap" Storyboard.TargetProperty="(UIElement.RenderTransform).(CompositeTransform.TranslateY)">
                                <LinearDoubleKeyFrame KeyTime="0:0:0" Value="140" />
                                <LinearDoubleKeyFrame KeyTime="0:0:0.4" Value="140" />
                                <SplineDoubleKeyFrame KeySpline="0.1 0.9 0.2 1.0" KeyTime="0:0:1.2" Value="0" />
                            </DoubleAnimationUsingKeyFrames>
                            <DoubleAnimationUsingKeyFrames Storyboard.TargetName="FontListGrid" Storyboard.TargetProperty="Opacity">
                                <LinearDoubleKeyFrame KeyTime="0:0:0" Value="0" />
                                <LinearDoubleKeyFrame KeyTime="0:0:0.4" Value="0" />
                                <LinearDoubleKeyFrame KeyTime="0:0:0.73" Value="1" />
                            </DoubleAnimationUsingKeyFrames>
                            <DoubleAnimationUsingKeyFrames Storyboard.TargetName="FontListGrid" Storyboard.TargetProperty="(UIElement.RenderTransform).(CompositeTransform.TranslateY)">
                                <LinearDoubleKeyFrame KeyTime="0:0:0" Value="140" />
                                <LinearDoubleKeyFrame KeyTime="0:0:0.4" Value="140" />
                                <SplineDoubleKeyFrame KeySpline="0.1 0.9 0.2 1.0" KeyTime="0:0:1.2" Value="0" />
                            </DoubleAnimationUsingKeyFrames>
                        </Storyboard>
                    </VisualTransition>
                </VisualStateGroup.Transitions>
                <VisualState x:Name="FontsLoadingState">
                    <VisualState.Setters>
                        <Setter Target="CommandsGrid.Opacity" Value="0" />
                        <Setter Target="SplitView.Opacity" Value="0" />
                        <Setter Target="SplitView.IsHitTestVisible" Value="False" />
                        <Setter Target="FontTitleBlock.Visibility" Value="Collapsed" />
                        <Setter Target="SearchBox.IsEnabled" Value="False" />
                        <Setter Target="SearchBox.Opacity" Value="0" />
                        <Setter Target="ImportFontsButton.IsEnabled" Value="False" />
                        <Setter Target="OpenFontButton.IsEnabled" Value="False" />
                        <Setter Target="OpenFontButton.Opacity" Value="0.4" />
                        <Setter Target="HidePaneButton.IsEnabled" Value="False" />
                        <Setter Target="ShowPaneButton.IsEnabled" Value="False" />
                        <Setter Target="OpenFontPaneButton.IsEnabled" Value="False" />
                        <Setter Target="BtnSettings.IsEnabled" Value="False" />
                        <Setter Target="BtnSettings.Opacity" Value="0" />
                        <Setter Target="LoadingRing.IsActive" Value="True" />
                    </VisualState.Setters>
                </VisualState>
                <VisualState x:Name="FontsFailedState">
                    <VisualState.Setters>
                        <Setter Target="SplitView.Visibility" Value="Collapsed" />
                        <Setter Target="SearchBox.IsEnabled" Value="False" />
                        <Setter Target="HidePaneButton.IsEnabled" Value="False" />
                        <Setter Target="ShowPaneButton.IsEnabled" Value="False" />
                        <Setter Target="OpenFontPaneButton.IsEnabled" Value="False" />
                        <Setter Target="BtnSettings.IsEnabled" Value="False" />
                    </VisualState.Setters>
                </VisualState>
                <VisualState x:Name="FontsLoadedState" />
            </VisualStateGroup>
            <VisualStateGroup x:Name="FontStates">
                <VisualState x:Name="NoFontsState">
                    <VisualState.StateTriggers>
                        <StateTrigger IsActive="{x:Bind core:Converters.False(ViewModel.HasFonts), Mode=OneWay}" />
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <Setter Target="ImportFontHelpBlock.Visibility" Value="Visible" />
                    </VisualState.Setters>
                </VisualState>
                <VisualState x:Name="HasFontsState" />
            </VisualStateGroup>
            <VisualStateGroup x:Name="SearchStatesGroup">
                <VisualState x:Name="InstantSearchState">
                    <VisualState.StateTriggers>
                        <StateTrigger IsActive="{x:Bind ViewModel.Settings.UseInstantSearch, Mode=OneWay}" />
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <Setter Target="SearchBox.QueryIcon" Value="{x:Null}" />
                    </VisualState.Setters>
                </VisualState>
                <VisualState x:Name="ManualSearchState">
                    <VisualState.StateTriggers>
                        <StateTrigger IsActive="{x:Bind core:Converters.False(ViewModel.Settings.UseInstantSearch), Mode=OneWay}" />
                    </VisualState.StateTriggers>
                </VisualState>
            </VisualStateGroup>
        </VisualStateManager.VisualStateGroups>
    </Grid>
</Page>